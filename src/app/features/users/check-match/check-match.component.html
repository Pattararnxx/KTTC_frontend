<app-navbar></app-navbar>
<section class="min-h-[calc(100vh-110px)] px-4 sm:px-8 lg:px-40 py-10">
  <form [formGroup]="fg" class="flex flex-col sm:flex-row gap-4 sm:gap-12">
    <select formControlName="category"
            class="max-w-full sm:max-w-60 bg-[#c04000] border border-[#c04000] text-base sm:text-2xl text-white rounded-lg focus:ring-[#c04000] focus:border-[#c04000] block w-full p-2.5">
      <option value="" disabled>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</option>
      @for (category of categories; track category) {
        <option [value]="category">{{ category }}</option>
      }
    </select>

    <select formControlName="group"
            class="max-w-full sm:max-w-40 bg-[#c04000] border border-[#c04000] text-base sm:text-2xl text-white rounded-lg focus:ring-[#c04000] focus:border-[#c04000] block w-full p-2.5">
      <option value="" disabled>‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á</option>
      @for (group of groups; track group) {
        <option [value]="group">‡∏™‡∏≤‡∏¢ {{ group }}</option>
      }
    </select>

    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6">
      <div class="flex items-center">
        <input type="radio"
               id="radio1"
               formControlName="round"
               value="group"
               class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500">
        <label for="radio1" class="ms-2 text-lg sm:text-2xl font-normal text-gray-900">‡∏£‡∏≠‡∏ö‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°</label>
      </div>

      <div class="flex items-center">
        <input type="radio"
               id="radio2"
               formControlName="round"
               value="bracket"
               class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500">
        <label for="radio2" class="ms-2 text-lg sm:text-2xl font-normal text-gray-900">‡∏£‡∏≠‡∏ö 16 ‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</label>
      </div>
    </div>
  </form>
  <div *ngIf="loading()" class="flex justify-center items-center min-h-[200px] mt-20">
    <div class="animate-spin rounded-full h-12 w-12 border-4 border-orange-300 border-t-transparent"></div>
    <span class="ml-4 text-lg text-orange-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
  </div>

  @if ((!selectedCategory() || !selectedGroup()) && selectedRound() !== 'bracket'  && !loading()) {
    <div class="max-w-5xl mx-auto mt-20 sm:mt-40 text-center px-4">
      <div class="text-gray-400 text-5xl sm:text-7xl mb-4">üèì</div>
      <h2 class="text-2xl sm:text-3xl font-bold text-gray-600 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h2>
      <p class="text-gray-500 text-lg sm:text-xl">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</p>
    </div>
  }

  @if (selectedCategory() && selectedGroup() && !hasData()  && !loading()) {
    <div class="max-w-5xl mx-auto mt-20 sm:mt-40 text-center px-4">
      <div class="text-orange-400 text-5xl sm:text-7xl mb-4">‚ö†Ô∏è</div>
      <h2 class="text-2xl sm:text-3xl font-bold text-orange-600 mb-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h2>
      <p class="text-gray-500 text-lg sm:text-xl">{{ formTitle() }}</p>
    </div>
  }

  @if (hasData()&& selectedRound() == 'group'  && !loading()) {
    <div class="max-w-full lg:max-w-8xl mx-auto overflow-hidden">
      <div class="text-center py-6 sm:py-8 px-4">
        <h1 class="text-xl sm:text-2xl lg:text-5xl font-bold lg:font-semibold text-gray-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h1>
        <p class="text-gray-600 text-base sm:text-xl mt-2">{{ formTitle() }}</p>
      </div>

      <!--Desktop-->
      <div class="hidden lg:block overflow-x-auto px-8 pb-8">
        <table class="w-full">
          <thead>
          <tr class="border-b-2 border-gray-300">
            <th class="text-left py-6 px-6 text-xl font-bold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
            @for (player of currentPlayers(); track player.name; ) {
              <th class="text-center py-4 px-4 text-xl font-semibold text-gray-700 min-w-24">{{ player.name }}</th>
            }
            <th class="text-center py-4 px-6 text-xl font-bold text-gray-700 min-w-20">‡πÅ‡∏ï‡πâ‡∏°‡∏£‡∏ß‡∏°</th>
          </tr>
          </thead>
          <tbody>
            @for (player of currentPlayers(); track player.name; let i = $index) {
              <tr class="border-b border-gray-200 hover:bg-gray-50">
                <td class="py-12 px-6 text-xl font-semibold text-gray-700">{{ player.name }}</td>
                @for (opponent of currentPlayers(); track opponent.name; let j = $index) {
                  <td class="text-center py-4 px-4 text-xl" [class]="getCellClass(getMatchResult(i, j))">
                    {{ getMatchResult(i, j) }}
                  </td>
                }
                <td class="text-center py-4 px-6 text-xl font-bold text-black">{{ player.points }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!--Mobile-->
      <div class="block lg:hidden p-4">
        @for (player of currentPlayers(); track player.name; let i = $index) {
          <div class="border border-gray-200 rounded-lg mb-4 p-4 bg-white shadow-sm">
            <div class="flex justify-between items-center mb-4 pb-3 border-b border-gray-100">
              <h3 class="text-lg font-semibold text-gray-800">{{ player.name }}</h3>
              <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                {{ player.points }} ‡πÅ‡∏ï‡πâ‡∏°
              </span>
            </div>

            <div class="space-y-3">
              @for (opponent of currentPlayers(); track opponent.name; let j = $index) {
                @if (i !== j) {
                  <div class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded">
                    <span class="text-gray-700 font-medium">vs {{ opponent.name }}</span>
                    <span class="font-semibold" [class]="getCellClass(getMatchResult(i, j))">
                      {{ getMatchResult(i, j) }}
                    </span>
                  </div>
                }
              }
            </div>
          </div>
        }
      </div>
    </div>
  }
<!--  Bracket-->
  @if (hasData() && selectedRound() === 'bracket'  && !loading()) {
    <div class="flex py-12">
      <div class="bracket bracket-16">
        <!-- Round 1-->
        <div class="bracket-column round-16">
          @for (match of getMatchesByRound('round16');; track match.id) {
            <div class="bracket-match bracket-match--with-line">
              <div class="bracket-player">{{ match.player1?.firstname  || '-' }}</div>
              <div class="bracket-player">{{ match.player2?.firstname || '-' }}</div>
            </div>
          }
        </div>
        <!-- Round 2 -->
        <div class="bracket-column round-8">
          @for (match of getMatchesByRound('quarter');; track match.id) {
            <div class="bracket-join"></div>
            <div class="bracket-match bracket-match--with-line ">
              <div class="bracket-player">{{ match.player1?.firstname || '-' }}</div>
              <div class="bracket-player">{{ match.player2?.firstname || '-' }}</div>
            </div>
          }
        </div>
        <!-- Round 3-->
        <div class="bracket-column round-4">
          @for (match of getMatchesByRound('semi');; track match.id) {
            <div class="bracket-join"></div>
            <div class="bracket-match">
              <div class="bracket-player">{{ match.player1?.firstname || '-' }}</div>
              <div class="bracket-player">{{ match.player2?.firstname || '-' }}</div>
            </div>
          }
        </div>
        <!-- Final Round-->
        <div class="bracket-column round-2">
          @for (match of getMatchesByRound('final');; track match.id) {
            <div class="bracket-join"></div>
            <div class="bracket-match">
              <div class="bracket-player">{{ match.player1?.firstname || '-' }}</div>
              <div class="bracket-player">{{ match.player2?.firstname || '-' }}</div>
            </div>
          }
        </div>
      </div>
    </div>
    @if (tournamentWinner(); as winner) {
      <div class="mt-12 text-center p-6 bg-yellow-100 border-2 border-yellow-400 rounded-lg shadow-lg">
        <h2 class="text-3xl sm:text-4xl font-bold text-yellow-700 mb-2">üèÜ ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô üèÜ</h2>
        <p class="text-2xl sm:text-3xl text-yellow-800 font-semibold">
          {{ winner.firstname }} {{ winner.lastname || '' }}
        </p>
        <p class="text-lg text-yellow-600 mt-1">{{ selectedCategory() }}</p>
      </div>
    }
  }

</section>
